[은수] 실행 컨텍스트란 무엇인가요?

> - 실행 컨텍스트는 "객체" 입니다. 여기서, 현재 코드가 실행되고 있는 위치에 대한 정보를 담고 있는 "객체"라고 볼 수 있습니다.

[은수] 실행 컨텍스트와 렉시컬 환경의 차이는 무엇인가요?

> - 실행 컨텍스트는 "콜 스택"에서 저장됩니다. 반면 렉시컬 환경은 "힙 메모리"에 저장됩니다. 따라서, 실행 컨텍스트는 어느 한 함수 스코프가 (혹은 실행 컨텍스트 단위, 문맥이) 종료되면, 소멸됩니다.

[은수] 실행 컨텍스트와 렉시컬 환경은 왜 그런 식으로 동작하나요? 즉, 왜 분리되어 있나요?

> - 실행 컨텍스트는 "스택" 자료 구조로 구현됩니다. 즉, 현재 실행된 위치에 대한 정보만을 담고 있을 뿐, 이전 정보에 대한 정보가 제거되어 접근할 수 없습니다.
>   반면, 렉시컬 환경은 "힙" 자료 구조로 되어 있어, 상위 참조에 대한 접근이 가능한 자료 구조입니다.

> - 이렇게 분리되어 있는 이유는 실행 컨텍스트 내부 만으로 메모리 공간이 "불리"하기 때문입니다. 따라서, 메모리 공간을 따로 분리하여, 메모리 사용에 대한 유리함을 확보합니다.

> - 클로저는 이러한 힙 메모리의 자료 구조에 대한 특징에 의해 발생하는 "부수 효과"정도로도 이해할 수 있습니다.

[봉찬] 자바스크립트 엔진은 소스 코드를 2개의 과정으로 나누어 진행한다. 이 과정을 설명해 주세요.

> - 소스 코드 평가<br/>
>   실행 컨텍스트를 생성하고 변수, 함수의 선언문만 먼저 실행하여 실행 컨텍스트의 렉시컬 환경에 저장한다.
> - 소스 코드 실행<br/>
>   선언문을 제외한 나머지 코드를 순차적으로 실행한다. 실행에 필요한 정보(식별자)는 스코프 체인에 의해서 검색하고 참조한다. 코드의 실행 결과는 다시 실행 컨텍스트가 관리하는 렉시컬 환경에 저장한다.

[봉찬] 실행 중인 실행 컨텍스트가 종료되어 스택에서 제거되면 해당 실행 컨텍스트의 렉시컬 환경도 같이 소멸하나요? 그렇다면 또는 그렇지 않다면 그 이유를 설명해 주세요.

> - 소멸되지 않는다. 렉시컬 환경이 실행 컨텍스트에 의해 참조되지만 독립적인 객체다. 이는 클로저라는 개념이 존재하는 이유로 해당 렉시컬 환경을 참조하는 식별자가 존재한다면 가비지 컬렉션이 제거하지 않는다.

[봉찬] 다음 코드를 보고 console.log(a + b + x + y + z); 의 결과를 말씀해 주세요. 그리고 실행 컨텍스트의 생성과 식별자 검색 과정을 설명해 주세요.

```javascript
var x = 1;
const y = 2;

function foo(a) {
  const y = 4;

  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z); // ?
  }
  bar(10);
}
foo(20);
```

> 출력 40
>
> - 전역 소스 코드가 평가되어 전역 실행 컨텍스트가 생성된다.
> - 전역 렉시컬 환경이 생성되고 전역 환경 레코드(객체 환경 레코드, 선언적 환경 레코드)가 생성된다.
> - 객체 환경 레코드의 BindingObject 에 전역 객체가 참조된다.
> - var 키워드로 선언한 전역 변수 x 와 전역 함수 foo 는 객체 환경 레코드의 BindingObject의 전역 객체 프로퍼티에 저장된다. const 키워드로 선언한 y 변수는 선언적 환경 레코드에 저장된다.
> - 전역 소스 코드가 실행 되면서 x, y 에 값이 할당되고 foo 함수가 실행된다.
> - foo 함수가 실행되면 전역 코드의 실행이 중단되고 foo 함수의 실행 컨텍스트가 생성된다.
> - foo 함수의 소스 코드가 평가되어 함수의 렉시컬 환경에 지역 변수 y 와 지역 함수 bar 가 저장된다.
> - foo 함수의 소스 코드가 실행되어 y 에 값이 할당 되며 bar 함수가 실행된다.
> - bar 함수가 실행되면 foo 함수의 실행이 중단되고 bar 함수의 실행 컨텍스트가 생성된다.
> - bar 함수의 소스 코드가 평가되어 함수의 렉시컬 환경에 지역 변수 z 가 저장된다.
> - bar 함수의 소스 코드가 실행되고 console 을 현재 실행 중인 bar 실행 컨텍스트에서 식별자를 검색하고 없기 때문에 스코프 체인에 의해 foo를 거쳐서 전역 스코프에서 찾게 된다.
> - console 에서 프로토타입 체인으로 log 를 검색하는데 상속에 의한 메서드가 아니라 console 이 소유한 메서드로 실행한다.
> - 스코프 체인으로 a 는 foo 에서 b 는 bar 에서 x 는 전역 스코프에서 y 는 foo 에서 z 는 bar 에서 검색해서 표현식을 평가하고 console.log 메서드에 인수로 넘겨준다.
> - console.log 의 반환값 40 이 출력되고 bar 함수의 실행컨텍스트는 스택에서 삭제된다.
> - foo 함수도 더 이상 실행문이 없기 때문에 foo 함수의 실행 컨텍스트도 스택에서 제거된다.
> - 마지막으로 전역 실행 컨텍스트도 스택에서 제거되어 스택은 비어있게 된다.
